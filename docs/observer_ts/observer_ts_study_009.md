# ç¬¬9ç« ï¼šæ§‹é€ åŒ–ãƒ­ã‚°å…¥é–€ ğŸ§±âœ¨

ï¼ˆJSONã®è€ƒãˆæ–¹ï¼š**ã€Œã‚ã¨ã§çµã‚Šè¾¼ã‚ã‚‹ãƒ­ã‚°ã€**ã«ã™ã‚‹ã‚ˆï¼ğŸ”ï¼‰

---

## 0. ã“ã®ç« ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ ğŸ¯âœ¨

ã“ã®ç« ã‚’çµ‚ãˆã‚‹ã¨â€¦ğŸ‘‡

* **ã€Œæ§‹é€ åŒ–ãƒ­ã‚°ã£ã¦ä½•ï¼Ÿã€**ã‚’ä¸€è¨€ã§èª¬æ˜ã§ãã‚‹ ğŸ—£ï¸âœ¨
* æ–‡å­—åˆ—ãƒ­ã‚°ã‚’ **JSONãƒ­ã‚°ã«å¤‰æ›**ã§ãã‚‹ ğŸ§±â¡ï¸ğŸ§±
* ãƒ­ã‚°ã«å…¥ã‚Œã‚‹ **ã‚­ãƒ¼ï¼ˆé …ç›®ï¼‰ã‚’ãƒ–ãƒ¬ãªã„ã‚ˆã†ã«å›ºå®š**ã§ãã‚‹ ğŸ·ï¸ğŸ“Œ
* **PowerShellã§çµã‚Šè¾¼ã¿**ã§ãã‚‹ï¼ˆåœ°å‘³ã«è¶…å¤§äº‹ï¼‰ğŸ’»ğŸ”
* **ç§˜å¯†æƒ…å ±ãŒæ¼ã‚Œãªã„**ãƒ­ã‚°ã®å‡ºã—æ–¹ãŒã‚ã‹ã‚‹ ğŸ•µï¸â€â™€ï¸ğŸ›¡ï¸

---

## 1. æ§‹é€ åŒ–ãƒ­ã‚°ã£ã¦ãªã«ï¼ŸğŸ§©âœ¨

### ãµã¤ã†ã®ãƒ­ã‚°ï¼ˆã¤ã‚‰ã„â€¦ï¼‰ğŸ˜µâ€ğŸ’«

* æ–‡ç« ã ã‘ã ã¨ã€å¾Œã‹ã‚‰ã€Œæ¤œç´¢ã—ã«ãã„ã€ã€Œæ©Ÿæ¢°ã§é›†è¨ˆã—ã«ãã„ã€
* è¡¨è¨˜ã‚†ã‚Œã§æ­»ã¬ï¼ˆä¾‹ï¼š`userId` / `user_id` / `userid`ï¼‰ğŸ’€

### æ§‹é€ åŒ–ãƒ­ã‚°ï¼ˆã†ã‚Œã—ã„ï¼ï¼‰ğŸ˜‡âœ¨

**1è¡ŒãŒJSON**ã«ãªã£ã¦ã„ã¦ã€æ©Ÿæ¢°ãŒèª­ã¿ã‚„ã™ã„ãƒ­ã‚°ã®ã“ã¨ï¼
ã‚ã¨ã§ **ã€ŒeventãŒã“ã‚Œã€ã€ŒrequestIdãŒã“ã‚Œã€**ã£ã¦æ¡ä»¶ã§ã‚¹ãƒ‘ãƒƒã¨çµã‚Œã‚‹ğŸ”âœ¨

> ã„ã¾ã®Nodeç•Œéšˆã§ã‚‚ã€JSONã®æ§‹é€ åŒ–ãƒ­ã‚°ã¯â€œè¦³æ¸¬ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³â€ã«ä¹—ã›ã‚„ã™ã„åŸºæœ¬å½¢ã ã‚ˆã€œğŸŒ²âœ¨ ([GitHub][1])

---

## 2. ã„ã¡ã°ã‚“å¤§äº‹ãªè€ƒãˆæ–¹ ğŸ§ ğŸ’¡

### ã€Œmessage + propertiesã€æ–¹å¼ã«ã™ã‚‹ ğŸ§±âœ¨

æ§‹é€ åŒ–ãƒ­ã‚°ã®åŸºæœ¬ã¯ã“ã‚ŒğŸ‘‡

* `message`ï¼šäººé–“ãŒèª­ã‚€çŸ­æ–‡ ğŸ§‘â€ğŸ’»ğŸ’¬ï¼ˆ1è¡Œã§çŠ¶æ³ãŒã‚ã‹ã‚‹ï¼‰
* `properties`ï¼šæ©Ÿæ¢°ãŒçµã‚‹ãŸã‚ã®ã‚­ãƒ¼ã¨å€¤ ğŸ·ï¸ğŸ”ï¼ˆJSONã®ä¸­èº«ï¼‰

ãŸã¨ãˆã°â€¦

* message: `"signup failed"`
* properties: `{ event:"user.signup", reason:"email_taken", requestId:"..." }`

**äººé–“ãŒç†è§£ã—ã‚„ã™ã„ + æ©Ÿæ¢°ãŒé›†è¨ˆã—ã‚„ã™ã„**ã®ä¸¡å–ã‚Šã ã‚ˆğŸ¥³âœ¨

---

## 3. JSONãƒ­ã‚°ã®å½¢ã¯ã“ã†ã™ã‚‹ ğŸ§¾âœ¨

### 1è¡Œ1JSONãŒæœ€å¼· âœ…

ãƒ­ã‚°ã¯åŸºæœ¬ **NDJSONï¼ˆæ”¹è¡ŒåŒºåˆ‡ã‚ŠJSONï¼‰**ãŒæ‰±ã„ã‚„ã™ã„ã‚ˆï¼
ï¼ˆãƒ­ã‚°åŸºç›¤ã‚„ãƒ„ãƒ¼ãƒ«ãŒã ã„ãŸã„ã“ã®å½¢ã§å–œã¶ğŸ˜Šï¼‰

ä¾‹ğŸ‘‡ï¼ˆ1è¡ŒãŒ1ã‚¤ãƒ™ãƒ³ãƒˆï¼‰

```json
{"time":"2026-01-17T12:00:00.000Z","level":"info","event":"user.signup","requestId":"r-123","msg":"signup started"}
{"time":"2026-01-17T12:00:00.120Z","level":"warn","event":"user.signup","requestId":"r-123","reason":"email_taken","msg":"signup failed"}
```

---

## 4. ã¾ãšå›ºå®šã™ã‚‹ æœ€å°å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ğŸ·ï¸ğŸ“Œ

ã€Œã¾ãšã“ã‚Œã ã‘ã¯æ¯å›å…¥ã‚Œã‚‹ã€ã£ã¦ã„ã†ã‚»ãƒƒãƒˆã‚’æ±ºã‚ã‚‹ã¨ã€å¾Œã§æ¥½ï¼ğŸ¥¹âœ¨

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰       | ç›®çš„       | ä¾‹                   |
| ----------- | -------- | ------------------- |
| `time`      | ã„ã¤èµ·ããŸï¼Ÿ   | `"2026-01-17T..."`  |
| `level`     | é‡è¦åº¦      | `"info"` / `"warn"` |
| `event`     | ä½•ãŒèµ·ããŸï¼Ÿ   | `"user.signup"`     |
| `msg`       | äººé–“å‘ã‘èª¬æ˜   | `"signup failed"`   |
| `service`   | ã©ã®ã‚µãƒ¼ãƒ“ã‚¹ï¼Ÿ  | `"toy-api"`         |
| `env`       | ç’°å¢ƒ       | `"dev"` / `"prod"`  |
| `version`   | ãƒªãƒªãƒ¼ã‚¹è­˜åˆ¥   | `"1.3.0"`           |
| `requestId` | 1ãƒªã‚¯ã‚¨ã‚¹ãƒˆè¿½è·¡ | `"r-..."`           |

ãƒã‚¤ãƒ³ãƒˆã¯ **eventã‚’å¿…ãšå…¥ã‚Œã‚‹**ã“ã¨ï¼
ã€Œmsgã§æ¤œç´¢ã€ã‚ˆã‚Šã€Œeventã§æ¤œç´¢ã€ã®æ–¹ãŒåœ§å€’çš„ã«å¼·ã„ã‚ˆğŸ’ªğŸ”¥

---

## 5. ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ä½•ã‚’ä½¿ã†ï¼ŸğŸŒ²ğŸ§°

### ã¾ãšã¯ Pino æ¨ã— ğŸ¥‡âœ¨

Pinoã¯ **JSONãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**ã§ã€ãƒ­ã‚°ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’å°ã•ãã—ã‚„ã™ã„è¨­è¨ˆã ã‚ˆğŸŒ² ([GitHub][1])
ï¼ˆã‚ã¨ã‹ã‚‰åŸºç›¤ã«æµã™ã¨ãã‚‚ç›¸æ€§è‰¯ã„ğŸ‘ï¼‰

Winstonã‚‚å®šç•ªã§æŸ”è»Ÿãªã‚“ã ã‘ã©ã€ã¾ãšã¯ã€ŒJSONãŒè‡ªç„¶ã«å‡ºã‚‹ã€æ–¹ãŒå­¦ç¿’ãŒã‚¹ãƒ ãƒ¼ã‚ºğŸ˜Š
ï¼ˆWinstonã‚’é¸ã¶ãªã‚‰â€œå‡ºåŠ›å…ˆãŒå¤šå½©ã«å¿…è¦â€ãªæ™‚ã«å¼·ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰ ([Better Stack][2])

---

## 6. å®Ÿè£…ã—ã¦ã¿ã‚ˆã† TypeScript + Pino ğŸ§ªâœ¨

### 6.1 ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« ğŸ“¦

```bash
npm i pino
npm i -D pino-pretty
```

### 6.2 loggerã‚’1ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ã¨ã‚ã‚‹ ğŸ§±

`src/log.ts`

```ts
import pino from "pino";

export const logger = pino({
  level: process.env.LOG_LEVEL ?? "info",

  // æ¯å›å…±é€šã§ä»˜ã‘ãŸã„æƒ…å ±ï¼ˆãƒ–ãƒ¬é˜²æ­¢âœ¨ï¼‰
  base: {
    service: "toy-api",
    env: process.env.NODE_ENV ?? "development",
    version: process.env.APP_VERSION ?? "dev",
  },

  // ç§˜å¯†æƒ…å ±ã¯ãƒ­ã‚°ã«æ®‹ã•ãªã„ï¼ˆè¶…é‡è¦ğŸ›¡ï¸ï¼‰
  redact: {
    paths: [
      "req.headers.authorization",
      "req.headers.cookie",
      "*.password",
      "*.token",
    ],
    remove: true,
  },
});
```

Pinoã®`redact`ã¯ã€Œç‰¹å®šã‚­ãƒ¼ã‚’ãƒã‚¹ã‚¯/é™¤å»ã€ã§ãã‚‹æ©Ÿèƒ½ã ã‚ˆğŸ›¡ï¸âœ¨ï¼ˆ`remove: true`ã§ã‚­ãƒ¼ã”ã¨æ¶ˆã›ã‚‹ï¼‰ ([GitHub][3])

### 6.3 ä½¿ã†å´ã¯ã“ã† âœï¸

```ts
import { logger } from "./log";

logger.info(
  { event: "user.signup", requestId: "r-123", emailDomain: "example.com" },
  "signup started"
);

logger.warn(
  { event: "user.signup", requestId: "r-123", reason: "email_taken" },
  "signup failed"
);
```

âœ… **msgã¯çŸ­ã**
âœ… **çµã‚Šè¾¼ã¿ã¯ event / reason / requestId ã§ã‚„ã‚‹**
ã“ã®å½¢ãŒã„ã¡ã°ã‚“æ°—æŒã¡ã„ã„ã‚ˆğŸ˜Šâœ¨

---

## 7. ã‚¨ãƒ©ãƒ¼ã¯ æ–‡å­—åˆ—ã˜ã‚ƒãªãã¦ æ§‹é€ ã¨ã—ã¦å‡ºã™ ğŸ’¥ğŸ§¯

ã‚¨ãƒ©ãƒ¼ã‚’`msg`ã«ãƒ™ã‚¿è²¼ã‚Šã™ã‚‹ã¨ã€å¾Œã§é›†è¨ˆã§ããªãã¦å›°ã‚‹ğŸ˜¢

Pinoã¯ã‚¨ãƒ©ãƒ¼ç”¨ã®æ¨™æº–ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãŒç”¨æ„ã•ã‚Œã¦ã¦ã€`err`ã¨ã—ã¦æ¸¡ã™ã®ãŒå®šç•ªã ã‚ˆğŸ§¯âœ¨ ([npm][4])

```ts
try {
  throw new Error("DB timeout");
} catch (err) {
  logger.error(
    { event: "db.query", requestId: "r-123", err },
    "db query failed"
  );
}
```

---

## 8. ãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯è¦‹ã‚„ã™ãã—ãŸã„ ğŸ‘€âœ¨

é–‹ç™ºä¸­ã«JSONãŒã¤ã‚‰ã„ã¨ãã¯ **pino-pretty** ã‚’ä½¿ã†ã¨å¹¸ã›ğŸ˜Š

```bash
node dist/server.js | npx pino-pretty
```

æœ¬ç•ªã¯ **åŸºæœ¬JSONã®ã¾ã¾**ã§OKï¼ï¼ˆâ€œåŠ å·¥ã¯å¤–ã§â€ãŒå¼·ã„ï¼‰

---

## 9. Windowsã§ãƒ­ã‚°ã‚’çµã‚Šè¾¼ã‚€ PowerShellç·¨ ğŸ”ğŸ’»

ãƒ­ã‚°ãŒNDJSONï¼ˆ1è¡Œ1JSONï¼‰ãªã‚‰ã€PowerShellã§ã“ã†ã§ãã‚‹ã‚ˆâœ¨

### 9.1 eventã§çµã‚‹ ğŸ·ï¸

```powershell
Get-Content .\app.log |
  ForEach-Object { $_ | ConvertFrom-Json } |
  Where-Object { $_.event -eq "user.signup" } |
  Select-Object time, level, requestId, msg, reason
```

### 9.2 requestIdã§è¿½è·¡ ğŸ”—

```powershell
Get-Content .\app.log |
  Select-String '"requestId":"r-123"'
```

---

## 10. ã‚ã‚ŠãŒã¡äº‹æ•…ã‚ã‚‹ã‚ã‚‹ ğŸ˜±âš ï¸

### ã‚„ã£ã¡ã‚ƒãƒ€ãƒ¡ âŒ

* `msg`ã«æƒ…å ±ã‚’è©°ã‚è¾¼ã¿ã™ãï¼ˆæ©Ÿæ¢°ãŒæ‹¾ãˆãªã„ï¼‰ğŸ“¦ğŸ’¥
* ã‚­ãƒ¼åãŒæ¯å›é•ã†ï¼ˆ`userId`/`user_id`åœ°ç„ï¼‰ğŸŒ€
* **ãƒˆãƒ¼ã‚¯ãƒ³/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰/Cookie**ã‚’ãƒ­ã‚°ã«å‡ºã™ï¼ˆæ¼ã‚ŒãŸã‚‰çµ‚ã‚ã‚Šï¼‰ğŸ§¨
* å·¨å¤§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¸¸ã”ã¨å‡ºã™ï¼ˆãƒ­ã‚°ä»£ãŒçˆ†å¢—ğŸ’¸ï¼‰

### ã‚„ã‚‹ã¨æœ€é«˜ âœ…

* `event`ã‚’å¿…é ˆã«ã™ã‚‹ ğŸ·ï¸
* `requestId`ã‚’å¿…é ˆã«ã™ã‚‹ ğŸ”—
* ã€Œæœ€å°å¿…é ˆã‚»ãƒƒãƒˆã€ã‚’å®ˆã‚‹ ğŸ“Œ
* ç§˜å¯†ã¯`redact`ã§é™¤å» ğŸ›¡ï¸ ([GitHub][3])

---

## 11. ãƒŸãƒ‹æ¼”ç¿’ ğŸ’âœ¨

### æ¼”ç¿’Aï¼šå¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ±ºã‚ã‚ˆã† ğŸ·ï¸ğŸ“

ã‚ãªãŸã®é¡ŒæAPIã§ã€æœ€ä½é™ã“ã‚Œã‚’æ±ºã‚ã¦ã­ğŸ‘‡

* `event`ã®å‘½åãƒ«ãƒ¼ãƒ«ï¼ˆä¾‹ï¼š`domain.action`ï¼‰
* `requestId`ã®å½¢å¼ï¼ˆä¾‹ï¼š`r-<random>`ï¼‰
* `service/env/version`ã®åŸ‹ã‚æ–¹

### æ¼”ç¿’Bï¼šãƒ€ãƒ¡ãƒ­ã‚°ã‚’JSONã«å¤‰æ› âœï¸â¡ï¸ğŸ§±

ãƒ€ãƒ¡ä¾‹ğŸ˜¢

* `"user signup failed: email already exists"`

è‰¯ã„ä¾‹ğŸ˜Š

* `{ event:"user.signup", reason:"email_taken", requestId:"...", ... } + msg`

### æ¼”ç¿’Cï¼šPowerShellã§3æ¡ä»¶ãƒ•ã‚£ãƒ«ã‚¿ ğŸ”âœ¨

* `event = user.signup`
* `level = warnä»¥ä¸Š`
* `reason = email_taken`

---

## 12. AIã®ä½¿ã„ã©ã“ã‚ ğŸ¤–âœ¨

ï¼ˆãã®ã¾ã¾ã‚³ãƒ”ãƒšã§OKç³»ï¼ï¼‰

* **ãƒ­ã‚°ã‚¹ã‚­ãƒ¼ãƒè¡¨ã‚’ä½œã‚‹**
  ã€Œã“ã®APIã«å¿…è¦ãªæ§‹é€ åŒ–ãƒ­ã‚°ã®ã‚­ãƒ¼ä¸€è¦§ã‚’ã€å¿…é ˆ/ä»»æ„ã«åˆ†ã‘ã¦è¡¨ã«ã—ã¦ã€‚å‘½åã¯çµ±ä¸€ã—ã¦ã€eventä¾‹ã‚‚3ã¤å‡ºã—ã¦ã€

* **msgã‚’çŸ­ãæ•´ãˆã‚‹**
  ã€Œã“ã®ãƒ­ã‚°msgã‚’â€œäººé–“ãŒä¸€ç¬ã§ç†è§£ã§ãã‚‹çŸ­æ–‡â€ã«æ•´ãˆã¦ã€‚10æ¡ˆã€

* **redactå€™è£œã‚’æ´—ã„å‡ºã™**
  ã€Œã“ã®ã‚¢ãƒ—ãƒªã§ãƒ­ã‚°ã«å‡ºã—ã¡ã‚ƒãƒ€ãƒ¡ãªé …ç›®ã‚’åˆ—æŒ™ã—ã¦ã€redact pathsä¾‹ã‚‚ä½œã£ã¦ã€

---

## 13. ä»Šã©ããƒ¡ãƒ¢ 2026ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæ„Ÿ ğŸ†•âœ¨

* Nodeã¯æœ€è¿‘ **TypeScriptã‚’ãã®ã¾ã¾å®Ÿè¡Œ**ã§ãã‚‹æµã‚ŒãŒå¼·ãã¦ã€v22.18.0ä»¥é™ã¯â€œæ¶ˆã›ã‚‹å‹â€ã ã‘ãªã‚‰è¿½åŠ ãƒ•ãƒ©ã‚°ãªã—ã§å‹•ãã‚ˆï¼ˆå­¦ç¿’ãŒæ¥½ã«ãªã‚‹ã‚„ã¤ï¼ï¼‰ ([nodejs.org][5])
* OpenTelemetry JavaScriptã¯ã€**Traces/Metricsã¯Stable**ã ã‘ã© **Logsã¯Development**æ‰±ã„ãªã®ã§ã€ãƒ­ã‚°ã¯ã¾ãšâ€œJSONã§æ•´ãˆã‚‹â€ãŒå …å®Ÿã ã‚ˆğŸ§µğŸ“ˆğŸªµ ([OpenTelemetry][6])

---

## 14. ç« æœ«ãƒã‚§ãƒƒã‚¯ âœ…âœ¨

æ¬¡ã®è³ªå•ã«ã‚µã‚¯ãƒƒã¨ç­”ãˆã‚‰ã‚ŒãŸã‚‰å‹ã¡ï¼ğŸ¥³

1. æ§‹é€ åŒ–ãƒ­ã‚°ã®ã€Œmessage + propertiesã€ã£ã¦ä½•ï¼ŸğŸ§±
2. `event`ã‚’å¿…é ˆã«ã™ã‚‹ç†ç”±ã¯ï¼ŸğŸ·ï¸
3. `requestId`ãŒã‚ã‚‹ã¨ä½•ãŒå¬‰ã—ã„ï¼ŸğŸ”—
4. ç§˜å¯†æƒ…å ±ã‚’å®ˆã‚‹ä»•çµ„ã¿ã¯ï¼ŸğŸ›¡ï¸

---

## æ¬¡ç« ã®äºˆå‘Š ğŸšï¸âœ¨

æ¬¡ã¯ **ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«é‹ç”¨**ï¼
ã€Œdebug/info/warn/errorã‚’ã©ã†åˆ†ã‘ã‚‹ã¨ã€æœ¬ç•ªãŒé™ã‹ã§ã€ã§ã‚‚å›°ã‚‰ãªã„ã®ï¼Ÿã€ã£ã¦ã„ã† **é‹ç”¨ã®ã‚»ãƒ³ã‚¹**ã‚’ä½œã£ã¦ã„ãã‚ˆã€œğŸ˜ŠğŸ›ï¸

[1]: https://github.com/pinojs/pino?utm_source=chatgpt.com "pinojs/pino: ğŸŒ² super fast, all natural json logger"
[2]: https://betterstack.com/community/guides/logging/how-to-install-setup-and-use-winston-and-morgan-to-log-node-js-applications/?utm_source=chatgpt.com "A Complete Guide to Winston Logging in Node.js"
[3]: https://github.com/pinojs/pino/blob/main/docs/redaction.md?utm_source=chatgpt.com "pino/docs/redaction.md at main Â· pinojs/pino"
[4]: https://www.npmjs.com/package/pino-std-serializers?utm_source=chatgpt.com "pino-std-serializers"
[5]: https://nodejs.org/en/learn/typescript/run-natively?utm_source=chatgpt.com "Running TypeScript Natively"
[6]: https://opentelemetry.io/docs/languages/js/?utm_source=chatgpt.com "JavaScript"

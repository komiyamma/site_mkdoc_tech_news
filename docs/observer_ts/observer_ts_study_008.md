# ç¬¬8ç« ï¼šè‰¯ã„ãƒ­ã‚° / ãƒ€ãƒ¡ãƒ­ã‚° ğŸ˜‡ğŸ˜±ï¼ˆæ¤œç´¢ã§ãã‚‹ãƒ­ã‚°ï¼‰

> ã“ã®ç« ã®ãƒ†ãƒ¼ãƒã¯ã²ã¨ã“ã¨ã§è¨€ã†ã¨
> **ã€Œæœªæ¥ã®è‡ªåˆ†ï¼ˆor ãƒãƒ¼ãƒ ï¼‰ãŒã€è¿·å­ã«ãªã‚‰ãªã„ãƒ­ã‚°ã€**ã ã‚ˆã€œğŸ‘€ğŸ§­âœ¨

---

## 0) ã¾ãšæœ€é‡è¦ï¼šãƒ­ã‚°ã¯â€œæ›¸ãâ€ã‚ˆã‚Šâ€œæ¢ã™â€ãŒæœ¬ç•ª ğŸ”âœ¨

éšœå®³å¯¾å¿œã‚„èª¿æŸ»ã£ã¦ã€ã ã„ãŸã„ã“ã†ãªã‚‹ã‚ˆã­ğŸ‘‡

1. **ã„ã¾ä½•ãŒèµ·ãã¦ã‚‹ï¼Ÿ**ï¼ˆã–ã£ãã‚ŠæŠŠæ¡ï¼‰
2. **ã©ã“ã§ï¼Ÿ**ï¼ˆå…¥å£ï¼ŸDBï¼Ÿå¤–éƒ¨APIï¼Ÿï¼‰
3. **ãªãœï¼Ÿ**ï¼ˆåŸå› ã®ä»®èª¬ï¼‰
4. **è¨¼æ‹ ã¯ï¼Ÿ**ï¼ˆãƒ­ã‚°ã§è£å–ã‚Šï¼‰

ã“ã®ã¨ããƒ­ã‚°ãŒ **æ¤œç´¢ã§ããªã„**ã¨ã€èª¿æŸ»ãŒã€Œé‹ã‚²ãƒ¼ã€ã«ãªã‚‹ğŸ˜±ğŸ°
é€†ã«æ¤œç´¢ã§ãã‚‹ãƒ­ã‚°ãªã‚‰ã€**â€œã™ãçµã‚Œã‚‹â†’ã™ãè¾¿ã‚Œã‚‹â€** ã‹ã‚‰è¶…ãƒ©ã‚¯ğŸ˜Šâœ¨

---

## 1) ãƒ€ãƒ¡ãƒ­ã‚°ã‚ã‚‹ã‚ã‚‹ ğŸ˜±ğŸªµï¼ˆèª¿æŸ»ã‚’æ®ºã™ãƒ­ã‚°ï¼‰

### ãƒ€ãƒ¡â‘ ï¼šæ°—æŒã¡ãƒ­ã‚°ï¼ˆæƒ…å ±ãŒç„¡ã„ï¼‰

* ã€Œå‡¦ç†å¤±æ•—ã—ã¾ã—ãŸã€
* ã€Œã‚¨ãƒ©ãƒ¼ã§ã™ã€
* ã€Œãªã‚“ã‹ãŠã‹ã—ã„ã€

ğŸ‘‰ **ä½•ãŒ / ã©ã“ã§ / ã©ã®å…¥åŠ›ã§ / ã©ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ / ã©ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§** ãŒç„¡ã„ã¨è©°ã‚€ğŸ’¥

---

### ãƒ€ãƒ¡â‘¡ï¼šæ–‡ç« ã«å…¨éƒ¨åŸ‹ã‚è¾¼ã‚€ï¼ˆæ¤œç´¢ã—ã«ãã„ï¼‰

* `User 12345 purchased item 98765 price 1200 ...`

ğŸ‘‰ æ•°å­—ãŒåŸ‹ã¾ã£ã¦ã‚‹ã¨ã€ã‚ã¨ã§ **ã€ŒuserId=12345ã€ã¿ãŸã„ã«æ©Ÿæ¢°çš„ã«çµã‚Œãªã„**ğŸ˜µâ€ğŸ’«

---

### ãƒ€ãƒ¡â‘¢ï¼šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒæ¯å›é•ã†ï¼ˆæºã‚Œãƒ­ã‚°ï¼‰

* `userId` / `user_id` / `uid` ãŒæ··åœ¨
* `requestId` / `reqId` / `rid` ãŒæ··åœ¨

ğŸ‘‰ **åŒã˜æ„å‘³ãªã®ã«æ¤œç´¢ãŒåˆ†è£‚**ã—ã¦åœ°ç„ğŸ‘¿

---

### ãƒ€ãƒ¡â‘£ï¼š1è¡Œã«å…¨éƒ¨ç››ã‚Šï¼ˆãƒã‚¤ã‚ºï¼‰

* æˆåŠŸã§ã‚‚å¤±æ•—ã§ã‚‚åŒã˜ç†±é‡ã§é•·æ–‡ãƒ­ã‚°
* æ¯å›å·¨å¤§ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ `JSON.stringify()` ã—ã¦å‡ºã™

ğŸ‘‰ **å¿…è¦ãªãƒ­ã‚°ãŒãƒã‚¤ã‚ºã«åŸ‹ã‚‚ã‚Œã‚‹**ğŸ« 

---

### ãƒ€ãƒ¡â‘¤ï¼šç§˜å¯†ã‚„å€‹äººæƒ…å ±ã‚’ãã®ã¾ã¾å‡ºã™ï¼ˆå±é™ºï¼‰

* ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ãƒˆãƒ¼ã‚¯ãƒ³ã€Cookieã€èªè¨¼ãƒ˜ãƒƒãƒ€
* ãƒ¡ãƒ¼ãƒ«ã€ä½æ‰€ã€ã‚«ãƒ¼ãƒ‰ã€å€‹äººç‰¹å®šID ãªã©

ğŸ‘‰ äº‹æ•…ã£ãŸã¨ãã®è¢«å®³ãŒãƒ¤ãƒã„âš ï¸
ï¼ˆã—ã‹ã‚‚ãƒ­ã‚°åŸºç›¤ã«æ®‹ã‚Šç¶šã‘ã‚‹â€¦ğŸ˜±ï¼‰

---

## 2) è‰¯ã„ãƒ­ã‚°ã®åˆè¨€è‘‰ï¼š**ã‚¤ãƒ™ãƒ³ãƒˆ + æ–‡è„ˆ + çµæœ** âœ…âœ¨

ãƒ­ã‚°ã‚’ã€Œæ¤œç´¢ã§ãã‚‹å½¢ã€ã«ã™ã‚‹ã‚³ãƒ„ã¯ã“ã‚ŒğŸ‘‡

### âœ… (A) ã‚¤ãƒ™ãƒ³ãƒˆåã‚’ä»˜ã‘ã‚‹ï¼ˆä½•ãŒèµ·ããŸï¼Ÿï¼‰

ä¾‹ï¼š

* `order.create.started`
* `order.create.succeeded`
* `order.create.failed`
* `external.payment.request`
* `db.query.slow`

ğŸ‘‰ ã“ã‚Œã ã‘ã§ **æ¤œç´¢ã®å…¥å£ãŒçˆ†é€Ÿ**ğŸš€

---

### âœ… (B) æ–‡è„ˆã¯â€œãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰â€ã§æŒã¤ï¼ˆã‚ã¨ã§çµã‚‹ç”¨ï¼‰

ä¾‹ï¼š

* `requestId`ï¼ˆç›¸é–¢IDï¼‰
* `trace.id` / `span.id`ï¼ˆãƒˆãƒ¬ãƒ¼ã‚¹é€£æºï¼‰
* `userId`ï¼ˆâ€»åŒ¿ååŒ–/ãƒãƒƒã‚·ãƒ¥æ¨å¥¨ï¼‰
* `orderId`
* `http.method`, `http.route`
* `duration_ms`
* `error.type`, `error.message`

**ECS ã§ã‚‚ `trace.id` ã¯ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§æ‰±ã†**å‰æã«ãªã£ã¦ã‚‹ã‚ˆï¼ˆãƒã‚¹ãƒˆã˜ã‚ƒãªã„ï¼‰ğŸ“Œ ([Elastic][1])
OpenTelemetry å´ã‚‚ãƒ­ã‚°ã¨ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’çµã³ãŸã„ã®ã§ã€**trace/span ã®IDã‚’ãƒ­ã‚°ã«è¼‰ã›ã‚‹**é‹ç”¨ã‚’æ¨ã—ã¦ã‚‹ã‚ˆğŸ”— ([OpenTelemetry][2])

---

### âœ… (C) çµæœã‚’â€œåˆ¤å®šã§ãã‚‹å½¢â€ã§æ®‹ã™ï¼ˆæˆåŠŸ/å¤±æ•—/é…ã„ï¼‰

* æˆåŠŸãªã‚‰ï¼š`status: "ok"`
* å¤±æ•—ãªã‚‰ï¼š`status: "error"` + `error.*`
* é…ã„ãªã‚‰ï¼š`duration_ms`ï¼ˆæ•°å€¤ï¼ï¼‰

ğŸ‘‰ ã€Œé…ã„ã®ä½•ä»¶ï¼Ÿã€ã¿ãŸã„ãªé›†è¨ˆã‚‚ã§ãã‚‹ğŸ“ˆâœ¨

---

## 3) â€œæ¤œç´¢ã§ãã‚‹ãƒ­ã‚°â€ã®æœ€å°ã‚»ãƒƒãƒˆï¼ˆã¾ãšã¯ã“ã‚Œã ã‘ã§OKï¼‰ğŸ§©âœ¨

æœ€åˆã¯æ¬²å¼µã‚‰ãšã«ã€ã“ã® **8ç‚¹ã‚»ãƒƒãƒˆ** ã ã‘å›ºå®šã—ã‚ˆğŸ‘‡

1. `event`ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆåï¼‰
2. `level`ï¼ˆinfo/warn/errorâ€¦ï¼‰
3. `message`ï¼ˆäººé–“å‘ã‘ä¸€è¨€ï¼‰
4. `requestId`ï¼ˆãƒ­ã‚°ã‚’ã¤ãªãIDï¼‰
5. `trace.id`ï¼ˆå¾Œã§ãƒˆãƒ¬ãƒ¼ã‚¹ã¨åˆæµï¼‰
6. `service`ï¼ˆã‚µãƒ¼ãƒ“ã‚¹åï¼‰
7. `env`ï¼ˆprod/stg/dev ãªã©ï¼‰
8. `version`ï¼ˆãƒ“ãƒ«ãƒ‰/ãƒªãƒªãƒ¼ã‚¹è­˜åˆ¥ï¼‰

> OpenTelemetry JS ã¯ Traces/Metrics ã¯å®‰å®šå¯„ã‚Šã ã‘ã©ã€**Logs ã¯ã¾ã  â€œDevelopmentâ€ æ‰±ã„**ãªã®ã§ã€ä»Šã¯ã€Œãƒ­ã‚°è‡ªä½“ã‚’ã‚­ãƒ¬ã‚¤ã«ä½œã‚‹ã€ã»ã†ãŒå‹ã¡ã‚„ã™ã„ã‚ˆğŸ˜Š ([OpenTelemetry][3])

---

## 4) ä¾‹ã§ä½“æ„Ÿï¼ãƒ€ãƒ¡ãƒ­ã‚° â†’ è‰¯ã„ãƒ­ã‚° âœï¸âœ¨

### ã‚±ãƒ¼ã‚¹â‘ ï¼šå¤–éƒ¨APIãŒå¤±æ•—ã—ãŸ

**ğŸ˜± ãƒ€ãƒ¡**

* `æ±ºæ¸ˆã«å¤±æ•—ã—ã¾ã—ãŸ`

**ğŸ˜‡ è‰¯ã„**

* event: `payment.charge.failed`
* è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼š`requestId`, `orderId`, `provider`, `http.status_code`, `duration_ms`, `error.type`

ğŸ‘‰ ã“ã‚Œã§ã€Œã©ã®æ³¨æ–‡ãŒã€ã€Œã©ã®æ±ºæ¸ˆä¼šç¤¾ã§ã€ã€Œä½•msã§ã€ã€Œä½•ã‚¨ãƒ©ãƒ¼ã‹ã€ãŒä¸€ç¬ã§åˆ†ã‹ã‚‹ğŸ”âœ¨

---

### ã‚±ãƒ¼ã‚¹â‘¡ï¼šé…ã„å‡¦ç†ã‚’è¦‹ã¤ã‘ãŸã„

**ğŸ˜± ãƒ€ãƒ¡**

* `é…ã„ã§ã™`

**ğŸ˜‡ è‰¯ã„**

* event: `db.query.slow`
* è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼š`duration_ms`ï¼ˆæ•°å€¤ï¼ï¼‰ `db.operation` `db.table`ï¼ˆâ€»ãƒ†ãƒ¼ãƒ–ãƒ«åã¯OKã€SQLå…¨æ–‡ã¯æ…é‡ã«ï¼‰

ğŸ‘‰ `event=db.query.slow AND duration_ms>1000` ã¨ã‹ã§ç‹©ã‚Œã‚‹ğŸ—¡ï¸âœ¨

---

## 5) TypeScriptã®â€œè‰¯ã„ãƒ­ã‚°â€ã®å½¢ï¼ˆè»½ãé›°å›²æ°—ï¼‰ğŸŒ²âœ¨

JSONãƒ­ã‚°ã‚’ä½œã‚‹ãªã‚‰ã€Nodeç•Œéšˆã ã¨ **Pino** ãŒå®šç•ªã§å¼·ã„ã‚ˆï¼ˆJSONå‰æï¼†é€Ÿã„ï¼‰ğŸŒ²
2026-01æ™‚ç‚¹ã§ã‚‚æ™®é€šã«ç¾å½¹ã§ã€æœ€æ–°ç‰ˆãƒªãƒªãƒ¼ã‚¹ã‚‚å‹•ã„ã¦ã‚‹ã‚ˆğŸ“¦âœ¨ ([GitHub][4])

```ts
import pino from "pino";

export const logger = pino({
  level: process.env.LOG_LEVEL ?? "info",
  base: {
    service: "example-api",
    env: process.env.NODE_ENV ?? "dev",
    version: process.env.APP_VERSION ?? "dev",
  },
});

// ä¾‹ï¼šè‰¯ã„ãƒ­ã‚°ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆ + æ–‡è„ˆ + çµæœï¼‰
logger.info(
  {
    event: "order.create.succeeded",
    requestId: "req-123",
    "trace.id": "4bf92f3577b34da6a3ce929d0e0e4736",
    "span.id": "00f067aa0ba902b7",
    orderId: "ord-999",
    duration_ms: 42,
    status: "ok",
  },
  "order created"
);
```

> `trace.id` / `span.id` ã‚’ãƒ­ã‚°ã«å…¥ã‚Œã‚‹ã¨ã€å¾Œã§ãƒˆãƒ¬ãƒ¼ã‚¹ã¨åˆæµã§ãã¦èª¿æŸ»ãŒè¶…ãƒ©ã‚¯ğŸ”— ([OpenTelemetry][2])

---

## 6) ç§˜å¯†ã‚’ãƒ­ã‚°ã«å‡ºã•ãªã„ï¼â€œãƒã‚¹ã‚­ãƒ³ã‚°â€ã®åŸºæœ¬ ğŸ«£ğŸ”’âœ¨

Pino ã«ã¯ **redactï¼ˆä¼ã›å­—ï¼‰**ãŒã‚ã‚‹ã‚ˆğŸ‘
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚ `redact` ã¯å…¬å¼ã«æ¡ˆå†…ã•ã‚Œã¦ã‚‹ğŸ“Œ ([GitHub][5])

```ts
import pino from "pino";

export const logger = pino({
  redact: [
    "req.headers.authorization",
    "req.headers.cookie",
    "password",
    "token",
  ],
});
```

ğŸ‘‰ èªè¨¼ç³»ã¯ **çµ¶å¯¾ã«ãã®ã¾ã¾å‡ºã•ãªã„**ã®ãŒåŸºæœ¬ã ã‚ˆâš ï¸âœ¨

---

## 7) ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ã€Œæœ€ä½é™ã€ãƒ†ãƒ³ãƒ—ãƒ¬ ğŸ§¯ğŸ’¥

ã‚¨ãƒ©ãƒ¼ã¯ â€œå¾Œã§èª¿ã¹ã‚‹â€ ã®ä¸»å½¹ï¼
OpenTelemetry ã®ä¾‹å¤–ç³»ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ã‚‚ã€ãƒ­ã‚°ã«ä¾‹å¤–å±æ€§ã‚’è¼‰ã›ã‚‹æ–¹å‘ã ã‚ˆğŸ§¾ ([OpenTelemetry][6])

**ãŠã™ã™ã‚æœ€ä½ã‚»ãƒƒãƒˆğŸ‘‡**

* `event`: `*.failed`
* `status`: `"error"`
* `error.type`
* `error.message`
* `error.stack`ï¼ˆé•·ã„ã®ã§å¿…è¦ãªã¨ãã ã‘ã§ã‚‚OKï¼‰
* `requestId`
* `trace.id` / `span.id`

---

## 8) ãƒŸãƒ‹æ¼”ç¿’ï¼šãƒ€ãƒ¡ãƒ­ã‚°ã‚’è‰¯ã„ãƒ­ã‚°ã«å¤‰æ›ã—ã‚ˆã† âœï¸ğŸŒŸ

### ãŠé¡Œï¼ˆãƒ€ãƒ¡ãƒ­ã‚°ï¼‰

1. `ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—`
2. `æ±ºæ¸ˆã«å¤±æ•—ã—ã¾ã—ãŸ`
3. `DBãŒé…ã„`
4. `ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—`
5. `å¤–éƒ¨APIã‚¨ãƒ©ãƒ¼`

### ãƒ«ãƒ¼ãƒ«

* ãã‚Œãã‚Œ **eventå** ã‚’ä»˜ã‘ã‚‹
* **requestId** ã‚’å¿…ãšå…¥ã‚Œã‚‹
* ã€Œçµã‚Œã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã‚’3ã¤ä»¥ä¸Šè¿½åŠ ã™ã‚‹

---

### è§£ç­”ä¾‹ï¼ˆã²ã¨ã¤ã ã‘è¦‹ã›ã‚‹ã­ğŸ‘€âœ¨ï¼‰

**2. æ±ºæ¸ˆã«å¤±æ•—ã—ã¾ã—ãŸ â†’**

* `event: "payment.charge.failed"`
* `requestId`
* `orderId`
* `provider`
* `http.status_code`
* `duration_ms`
* `error.type`, `error.message`

ï¼ˆæ®‹ã‚Šã¯ã‚ãªãŸãŒä½œã£ã¦OKï¼AIã«æ·»å‰Šã•ã›ã‚‹ã¨çˆ†é€ŸğŸ¤–âœ¨ï¼‰

---

## 9) AIã«é ¼ã‚‹ã¨ãã®â€œè‰¯ã„ãŠé¡˜ã„ã®ä»•æ–¹â€ğŸ¤–ğŸ“âœ¨

ã‚³ãƒ”ãƒšã§ä½¿ãˆã‚‹ã‚ˆğŸ‘‡

> ã€Œæ¬¡ã®ãƒ­ã‚°æ–‡è¨€ã‚’ã€æ¤œç´¢ã—ã‚„ã™ã„æ§‹é€ åŒ–ãƒ­ã‚°ã«ç›´ã—ã¦ã€‚
> eventåã‚‚ä»˜ã‘ã¦ã€requestId/trace.id/span.id ã‚’å‰æã«ã€çµã‚Šè¾¼ã¿ç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æœ€ä½3ã¤å…¥ã‚Œã¦ã€‚
> å€‹äººæƒ…å ±ã‚„ç§˜å¯†ï¼ˆtoken/password/auth headerï¼‰ã¯çµ¶å¯¾ã«å‡ºã•ãªã„ã§ã€‚ã€

---

## 10) ç« æœ«ãƒã‚§ãƒƒã‚¯ âœ…ğŸ’®ï¼ˆã“ã“ã ã‘æŠ¼ã•ãˆãŸã‚‰å‹ã¡ï¼‰

* [ ] ãƒ­ã‚°ã¯ã€Œæ›¸ãã€ã‚ˆã‚Šã€Œ**æ¢ã™**ã€ãŒæœ¬ç•ªğŸ”
* [ ] **ã‚¤ãƒ™ãƒ³ãƒˆå**ãŒã‚ã‚‹ï¼ˆ`xxx.yyy.succeeded` ã¿ãŸã„ã«ï¼‰ğŸ·ï¸
* [ ] æ–‡è„ˆã¯æ–‡ç« ã˜ã‚ƒãªã **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**ã§æŒã£ã¦ã‚‹ğŸ§©
* [ ] `requestId` ã¯å¿…é ˆï¼ˆã¤ãªãï¼‰ğŸ”—
* [ ] `trace.id` / `span.id` ã‚’å…¥ã‚Œã‚‹ã¨å°†æ¥ã‚ã£ã¡ã‚ƒå¼·ã„ğŸ”— ([OpenTelemetry][2])
* [ ] ç§˜å¯†ã¯ `redact` ãªã©ã§ä¼ã›ã‚‹ğŸ”’ ([GitHub][5])

---

æ¬¡ã®ç¬¬9ç« ï¼ˆæ§‹é€ åŒ–ãƒ­ã‚°å…¥é–€ğŸ§±âœ¨ï¼‰ã§ã¯ã€ã„ã¾ä½œã£ãŸã€Œè‰¯ã„ãƒ­ã‚°ã®å‹ã€ã‚’ã€**JSONã¨ã—ã¦å®‰å®šé‹ç”¨ã™ã‚‹è¨­è¨ˆ**ã«è½ã¨ã—ã¦ã„ãã‚ˆã€œğŸ˜ŠğŸ“¦âœ¨

[1]: https://www.elastic.co/docs/reference/ecs/ecs-tracing?utm_source=chatgpt.com "Elastic Common Schema (ECS) - Tracing fields"
[2]: https://opentelemetry.io/docs/specs/otel/logs/?utm_source=chatgpt.com "OpenTelemetry Logging"
[3]: https://opentelemetry.io/docs/languages/js/?utm_source=chatgpt.com "JavaScript"
[4]: https://github.com/pinojs/pino/releases?utm_source=chatgpt.com "Releases Â· pinojs/pino"
[5]: https://github.com/pinojs/pino/blob/main/docs/redaction.md?utm_source=chatgpt.com "pino/docs/redaction.md at main Â· pinojs/pino"
[6]: https://opentelemetry.io/docs/specs/semconv/exceptions/exceptions-logs/?utm_source=chatgpt.com "Semantic conventions for exceptions in logs"

# ç¬¬21ç« ã€€æ¥ç¶šãŒå±±å ´ï¼šã‚¹ã‚­ãƒ¼ãƒâ†’å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆã®æµã‚ŒğŸ”ï¸ğŸ”—

ã“ã®ç« ã¯ã­ã€**ã€Œå¢ƒç•Œã§ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼ã—ãŸçµæœã€ã‹ã‚‰ã€Œãƒ‰ãƒ¡ã‚¤ãƒ³ã®å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆVOï¼‰ã€ã¸å®‰å…¨ã«â€œã¤ãªãâ€**ã¨ã“ã‚ã‚’ã‚„ã‚‹ã‚ˆã€œï¼ğŸ¥°âœ¨
ã“ã“ãŒã§ãã‚‹ã¨ã€**å…¥åŠ›â†’æ¤œè¨¼â†’VOâ†’ãƒ‰ãƒ¡ã‚¤ãƒ³**ãŒä¸€æœ¬ç·šã«ãªã£ã¦ã€ãƒã‚°ãŒã‚ã£ã¡ã‚ƒæ¸›ã‚‹ã‚ˆğŸ›¡ï¸ğŸ’

---

## 1) ã¾ãšå¤§äº‹ãªäº‹å®Ÿï¼šã€Œã‚¹ã‚­ãƒ¼ãƒOKã€â‰ ã€Œãƒ‰ãƒ¡ã‚¤ãƒ³OKã€ğŸ˜…âš ï¸

ã‚¹ã‚­ãƒ¼ãƒï¼ˆZod/Valibotã¨ã‹ï¼‰ã¯ä¸»ã« **â€œå½¢ï¼ˆstructureï¼‰â€** ã‚’å®ˆã‚‹ã®ãŒå¾—æ„ï¼âœ…
ã§ã‚‚ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆæ¥­å‹™ãƒ«ãƒ¼ãƒ«ï¼‰ã¯ **â€œæ„å‘³ï¼ˆsemanticsï¼‰â€** ãŒå±±ã»ã©ã‚ã‚‹ã‚ˆã­ã€œğŸ˜µâ€ğŸ’«

ãŸã¨ãˆã°ğŸ‘‡

* ã‚¹ã‚­ãƒ¼ãƒ: `email` ã¯ `string` ã§ã€`@` ãŒå…¥ã£ã¦ã‚‹ âœ…
* ãƒ‰ãƒ¡ã‚¤ãƒ³:

  * å‰å¾Œã‚¹ãƒšãƒ¼ã‚¹ã¯è¨±ã•ãªã„ğŸ§¼
  * å°æ–‡å­—ã«æ­£è¦åŒ–ã™ã‚‹ğŸ”¤
  * æœ€å¤§é•·ãŒã‚ã‚‹ğŸ“
  * ã€Œã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ç¤¾å†…ãƒ‰ãƒ¡ã‚¤ãƒ³ã ã‘OKã€ãªã©ã®æ¥­å‹™ãƒ«ãƒ¼ãƒ«ğŸ¢
  * â€¦ãªã©ãªã©ğŸ’¥

ãªã®ã§æ–¹é‡ã¯ã“ã‚Œï¼ğŸ‘‡

> **ã‚¹ã‚­ãƒ¼ãƒï¼å…¥åŠ›ã®æœ€ä½æ¡ä»¶**
> **VOï¼ãƒ‰ãƒ¡ã‚¤ãƒ³ã®çµ¶å¯¾æ¡ä»¶ï¼ˆä¸å¤‰æ¡ä»¶ï¼‰**
> **å¢ƒç•Œã§ä¸¡æ–¹ã‚„ã£ã¦ã€ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã¯ä¿¡ã˜ã‚‹**ğŸ›¡ï¸âœ¨

---

## 2) ä»Šæ—¥æ™‚ç‚¹ã®å®šç•ªãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ„Ÿï¼ˆæƒ…å ±ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆğŸ†•ğŸ¤–ï¼‰

* **TypeScript** ã¯ npm ä¸Šã ã¨ `5.9.3` ãŒæœ€æ–°ã¨ã—ã¦æ²è¼‰ï¼ˆ2026/01æ™‚ç‚¹ã®ç¢ºèªï¼‰ ([NPM][1])
* **Zod** ã¯ npm ä¸Šã ã¨ `4.3.5` ãŒæœ€æ–°ã¨ã—ã¦æ²è¼‰ï¼ˆ2026/01æ™‚ç‚¹ï¼‰ ([NPM][2])
* **Zod 4** ã¯ã€Œstableã€ã«ãªã£ã¦ã€æ€§èƒ½/ä½“é¨“ã®æ”¹å–„ãŒæ˜è¨˜ã•ã‚Œã¦ã‚‹ã‚ˆ ([Zod][3])
* **Valibot** ã‚‚ npm ä¸Šã§ç¶™ç¶šæ›´æ–°ã•ã‚Œã¦ã¦ã€æœ€æ–° `1.2.0` è¡¨ç¤ºï¼ˆ2026/01æ™‚ç‚¹ï¼‰ ([NPM][4])

ã“ã®ç« ã§ã¯ã€ä¾‹ã¯ **Zod** ã‚’ãƒ¡ã‚¤ãƒ³ã«ã™ã‚‹ã­ï¼ˆå‹æ¨è«–ï¼‹å®Ÿè¡Œæ™‚æ¤œè¨¼ã®æµã‚ŒãŒåˆ†ã‹ã‚Šã‚„ã™ã„â˜ºï¸ï¼‰ ([Zod][5])
ï¼ˆæœ€å¾Œã« Valibot ã®ç½®ãæ›ãˆã‚¤ãƒ¡ãƒ¼ã‚¸ã‚‚è»½ãå‡ºã™ã‚ˆğŸ«¶ï¼‰

---

## 3) ã‚´ãƒ¼ãƒ«ã®å®Œæˆå½¢ï¼ˆä¸€æœ¬ç·šğŸ§µâœ¨ï¼‰

ã‚„ã‚ŠãŸã„ã®ã¯ã“ã®â€œãƒ‘ã‚¤ãƒ—â€ğŸ‘‡

```text
unknownå…¥åŠ›
   â†“
ã‚¹ã‚­ãƒ¼ãƒã§ã€Œå½¢ã€ã‚’æ¤œè¨¼ï¼ˆsafeParseï¼‰
   â†“
DTOï¼ˆæ¤œè¨¼æ¸ˆã¿ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ï¼‰
   â†“
VOã§ã€Œæ„å‘³ã€ã‚’æ¤œè¨¼ï¼†æ­£è¦åŒ–ï¼ˆcreate/parseï¼‰
   â†“
ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚³ãƒãƒ³ãƒ‰ / ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«
   â†“
ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å®Ÿè¡Œ
```

ãƒã‚¤ãƒ³ãƒˆã¯2ã¤ï¼ğŸ’¡

1. **ã‚¹ã‚­ãƒ¼ãƒã®ã‚¨ãƒ©ãƒ¼**ã¨**VOã®ã‚¨ãƒ©ãƒ¼**ã‚’ã€åŒã˜å½¢å¼ã§è¿”ã›ã‚‹ã¨æœ€é«˜ğŸ˜
2. **ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯ã‚¹ã‚­ãƒ¼ãƒã«ä¾å­˜ã—ãªã„**ï¼ˆå¢ƒç•Œå´ã«é–‰ã˜è¾¼ã‚ã‚‹ï¼‰ğŸ°ğŸš§

---

## 4) ä¾‹é¡Œï¼šä¼šå“¡ç™»éŒ²ã®ã€Œå…¥åŠ›â†’VOâ†’ã‚³ãƒãƒ³ãƒ‰ã€ğŸ“âœ¨

### 4-1) å…¥åŠ›ï¼ˆå¤–ã‹ã‚‰æ¥ã‚‹ã‚‚ã®ï¼‰

* `email`
* `password`
* `displayName`
* `plan`ï¼ˆ"Free" | "Pro"ï¼‰

---

## 5) å®Ÿè£…ï¼šæœ€å°æ§‹æˆã§ã„ãã‚ˆã€œğŸ’»âœ¨

### 5-1) Resultå‹ï¼ˆå¤±æ•—ã‚’é›†ã‚ã‚„ã™ãã™ã‚‹ğŸ“¦ï¼‰

```ts
// src/shared/result.ts
export type Ok<T> = { ok: true; value: T };
export type Err<E> = { ok: false; error: E };
export type Result<T, E> = Ok<T> | Err<E>;

export const ok = <T>(value: T): Ok<T> => ({ ok: true, value });
export const err = <E>(error: E): Err<E> => ({ ok: false, error });
```

### 5-2) è¿”ã™ã‚¨ãƒ©ãƒ¼ã®å½¢ã‚’çµ±ä¸€ï¼ˆUIãŒå¬‰ã—ã„ğŸ«¶ï¼‰

```ts
// src/shared/fieldError.ts
export type FieldError = {
  path: string[];     // ["email"] ã¨ã‹ ["user","email"] ã¨ã‹
  message: string;    // ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  code: string;       // "invalid_email" ã¿ãŸã„ãªè­˜åˆ¥å­
};
```

---

## 6) ã‚¹ã‚­ãƒ¼ãƒï¼ˆZodï¼‰ã§ã€Œå½¢ã€ã‚’å®ˆã‚‹ğŸ“âœ…

```ts
// src/boundary/register/registerSchema.ts
import * as z from "zod";

export const RegisterDtoSchema = z.object({
  email: z.string().trim().min(1, "ãƒ¡ãƒ¼ãƒ«ã¯å¿…é ˆã ã‚ˆğŸ“©").max(254),
  password: z.string().min(8, "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰çŸ­ã„ã‚ˆã€œğŸ”‘").max(72),
  displayName: z.string().trim().min(1, "åå‰å…¥ã‚Œã¦ã­ğŸ™‚").max(30),
  plan: z.union([z.literal("Free"), z.literal("Pro")]),
});

export type RegisterDto = z.infer<typeof RegisterDtoSchema>;
```

Zodã¯ã€Œæ¤œè¨¼ã—ãŸã‚‰å‹ãŒä»˜ãã€ä½“é¨“ãŒå¾—æ„ã ã‚ˆã­ã€œğŸ‰ ([Zod][5])

---

## 7) VOï¼ˆå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã§ã€Œæ„å‘³ã€ã‚’å®ˆã‚‹ğŸ’ğŸ›¡ï¸

### 7-1) Email VOï¼ˆæ­£è¦åŒ–ï¼‹ä¸å¤‰æ¡ä»¶ï¼‰

```ts
// src/domain/email.ts
import { Result, ok, err } from "../shared/result";
import { FieldError } from "../shared/fieldError";

const EMAIL_MAX = 254;

// â€»å®Œç’§ãªãƒ¡ãƒ¼ãƒ«RFCãƒã‚§ãƒƒã‚¯ã¯é›£ã—ã„ã®ã§ã€ã“ã“ã¯ã€Œæœ€ä½é™ï¼‹é‹ç”¨ã§è£œã†ã€æƒ³å®šã«ã—ã¦ã‚‹ã‚ˆğŸ™‚
// ï¼ˆå³å¯†ã«ã—ã™ãã‚‹ã¨â€œæ­£ã—ã„ãƒ¡ãƒ¼ãƒ«â€ã‚’å¼¾ã„ã¡ã‚ƒã†ã“ã¨ã‚‚ã‚ã‚‹ã®â€¦ğŸ˜¢ï¼‰
const SIMPLE_EMAIL_REGEX = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

export class Email {
  private constructor(public readonly value: string) {}

  static create(raw: string, path: string[] = ["email"]): Result<Email, FieldError> {
    const normalized = raw.trim().toLowerCase();

    if (normalized.length === 0) {
      return err({ path, code: "email_required", message: "ãƒ¡ãƒ¼ãƒ«ã¯å¿…é ˆã ã‚ˆğŸ“©" });
    }
    if (normalized.length > EMAIL_MAX) {
      return err({ path, code: "email_too_long", message: "ãƒ¡ãƒ¼ãƒ«ãŒé•·ã™ãã‚‹ã‚ˆğŸ“" });
    }
    if (!SIMPLE_EMAIL_REGEX.test(normalized)) {
      return err({ path, code: "invalid_email", message: "ãƒ¡ãƒ¼ãƒ«ã®å½¢ãŒå¤‰ã‹ã‚‚â€¦ğŸ¤”" });
    }

    return ok(new Email(normalized));
  }
}
```

### 7-2) Password VOï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³å´ã®ãƒ«ãƒ¼ãƒ«ã¯ã“ã“ï¼ğŸ”’ï¼‰

```ts
// src/domain/password.ts
import { Result, ok, err } from "../shared/result";
import { FieldError } from "../shared/fieldError";

export class Password {
  private constructor(public readonly value: string) {}

  static create(raw: string, path: string[] = ["password"]): Result<Password, FieldError> {
    // æ­£è¦åŒ–ã¯ã€Œã‚„ã‚Šã™ãæ³¨æ„ã€ï¼šãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å‹æ‰‹ã«å¤‰å½¢ã—ãªã„ã»ã†ãŒå®‰å…¨ãªã“ã¨å¤šã„ã‚ˆğŸ™‚
    if (raw.length < 12) {
      return err({ path, code: "password_too_short", message: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯12æ–‡å­—ä»¥ä¸ŠãŒå®‰å¿ƒã ã‚ˆğŸ”" });
    }
    if (raw.length > 72) {
      return err({ path, code: "password_too_long", message: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰é•·ã™ãã‚‹ã‚ˆã€œğŸ˜µ" });
    }
    if (/\s/.test(raw)) {
      return err({ path, code: "password_has_space", message: "ç©ºç™½ã¯å…¥ã‚Œãªã„ã§ã­ğŸ™…â€â™€ï¸" });
    }
    // ä¾‹ï¼šæœ€ä½é™ã®å¼·åº¦ï¼ˆå¥½ã¿ã§èª¿æ•´OKï¼‰
    if (!/[a-zA-Z]/.test(raw) || !/[0-9]/.test(raw)) {
      return err({ path, code: "password_weak", message: "è‹±å­—ã¨æ•°å­—ã‚’æ··ãœã‚‹ã¨å¼·ã„ã‚ˆğŸ’ª" });
    }

    return ok(new Password(raw));
  }
}
```

### 7-3) DisplayName VO

```ts
// src/domain/displayName.ts
import { Result, ok, err } from "../shared/result";
import { FieldError } from "../shared/fieldError";

export class DisplayName {
  private constructor(public readonly value: string) {}

  static create(raw: string, path: string[] = ["displayName"]): Result<DisplayName, FieldError> {
    const normalized = raw.trim();

    if (normalized.length === 0) {
      return err({ path, code: "name_required", message: "è¡¨ç¤ºåã¯å¿…é ˆã ã‚ˆğŸ™‚" });
    }
    if (normalized.length > 30) {
      return err({ path, code: "name_too_long", message: "è¡¨ç¤ºåã¯30æ–‡å­—ã¾ã§ã ã‚ˆğŸ“" });
    }
    // åˆ¶å¾¡æ–‡å­—ã¨ã‹ã¯å¼¾ãï¼ˆæœ€ä½é™ï¼‰
    if (/[\u0000-\u001F\u007F]/.test(normalized)) {
      return err({ path, code: "name_invalid_chars", message: "ä½¿ãˆãªã„æ–‡å­—ãŒæ··ã–ã£ã¦ã‚‹ã‹ã‚‚â€¦ğŸ˜…" });
    }

    return ok(new DisplayName(normalized));
  }
}
```

---

## 8) ã¤ãªãé–¢æ•°ï¼šDTO â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚³ãƒãƒ³ãƒ‰ğŸ—ï¸âœ¨

ã€ŒVOä½œæˆã®å¤±æ•—ã‚’é›†ã‚ã‚‹ã€ãŸã‚ã®å°é“å…·ã‚’ä½œã‚‹ã‚ˆğŸ§°

```ts
// src/shared/collect.ts
import { Result, ok, err } from "./result";

export function collect<T, E>(results: Result<T, E>[]): Result<T[], E[]> {
  const values: T[] = [];
  const errors: E[] = [];

  for (const r of results) {
    if (r.ok) values.push(r.value);
    else errors.push(r.error);
  }

  return errors.length > 0 ? err(errors) : ok(values);
}
```

æ¬¡ã«ã€ç™»éŒ²ã‚³ãƒãƒ³ãƒ‰ã‚’ä½œã‚‹ğŸ‘‡

```ts
// src/domain/registerUserCommand.ts
import { Email } from "./email";
import { Password } from "./password";
import { DisplayName } from "./displayName";

export type Plan = "Free" | "Pro";

export type RegisterUserCommand = {
  email: Email;
  password: Password;
  displayName: DisplayName;
  plan: Plan;
};
```

DTOã‹ã‚‰å¤‰æ›ã™ã‚‹â€œæ¥ç¶šéƒ¨â€ãŒã“ã“ï¼ğŸ”ï¸ğŸ”—

```ts
// src/boundary/register/toDomain.ts
import { RegisterDto } from "./registerSchema";
import { Result, ok, err } from "../../shared/result";
import { FieldError } from "../../shared/fieldError";
import { Email } from "../../domain/email";
import { Password } from "../../domain/password";
import { DisplayName } from "../../domain/displayName";
import { RegisterUserCommand } from "../../domain/registerUserCommand";

export function toRegisterUserCommand(dto: RegisterDto): Result<RegisterUserCommand, FieldError[]> {
  const emailR = Email.create(dto.email, ["email"]);
  const passwordR = Password.create(dto.password, ["password"]);
  const nameR = DisplayName.create(dto.displayName, ["displayName"]);

  const errors: FieldError[] = [];
  if (!emailR.ok) errors.push(emailR.error);
  if (!passwordR.ok) errors.push(passwordR.error);
  if (!nameR.ok) errors.push(nameR.error);

  // ä¾‹ï¼šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ¨ªæ–­ã®ãƒ«ãƒ¼ãƒ«ã‚‚ã“ã“ã§è¶³ã›ã‚‹ã‚ˆâœ¨
  // ã€Œpasswordã«emailã‚’å«ã‚ãªã„ã€ã¨ã‹ï¼ˆã“ã“ã§ã¯è¶…ã–ã£ãã‚Šä¾‹ï¼‰
  if (emailR.ok && passwordR.ok) {
    const localPart = emailR.value.value.split("@")[0];
    if (localPart && dto.password.toLowerCase().includes(localPart.toLowerCase())) {
      errors.push({
        path: ["password"],
        code: "password_contains_email",
        message: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ãƒ¡ãƒ¼ãƒ«ã£ã½ã„æ–‡å­—ãŒå…¥ã£ã¦ã‚‹ã‚ˆã€œğŸ˜³ï¼ˆå±é™ºï¼ï¼‰",
      });
    }
  }

  if (errors.length > 0) return err(errors);

  // plan ã¯ã‚¹ã‚­ãƒ¼ãƒã§ union æ¸ˆã¿ã ã‹ã‚‰ã“ã“ã§ã¯ä¿¡ã˜ã¦OKğŸ™‚
  return ok({
    email: emailR.value,
    password: passwordR.value,
    displayName: nameR.value,
    plan: dto.plan,
  });
}
```

---

## 9) å¢ƒç•Œã®å…¥å£ï¼šunknown â†’ ã‚¹ã‚­ãƒ¼ãƒ â†’ VOï¼ˆå®Œæˆï¼ğŸ‰ï¼‰

Zod ã® `safeParse` ã§ã€Œä¾‹å¤–ã‚’æŠ•ã’ãšã«ã€æ‰±ã†ã®ãŒè¶…ãŠã™ã™ã‚ã ã‚ˆğŸ«¶
ï¼ˆZodè‡ªä½“ã®åŸºæœ¬ã¯å…¬å¼ã«ã‚‚è¼‰ã£ã¦ã‚‹ã‚ˆï¼‰ ([Zod][5])

```ts
// src/boundary/register/handleRegister.ts
import { RegisterDtoSchema } from "./registerSchema";
import { FieldError } from "../../shared/fieldError";
import { toRegisterUserCommand } from "./toDomain";

function zodIssuesToFieldErrors(issues: { path: (string | number)[]; message: string; code: string }[]): FieldError[] {
  return issues.map((i) => ({
    path: i.path.map(String),
    message: i.message,
    code: `schema_${i.code}`,
  }));
}

export function handleRegister(input: unknown) {
  // 1) å½¢ã‚’æ¤œè¨¼
  const parsed = RegisterDtoSchema.safeParse(input);
  if (!parsed.success) {
    return { ok: false as const, errors: zodIssuesToFieldErrors(parsed.error.issues) };
  }

  // 2) æ„å‘³ã‚’æ¤œè¨¼ï¼ˆVOç”Ÿæˆï¼‰
  const cmdR = toRegisterUserCommand(parsed.data);
  if (!cmdR.ok) {
    return { ok: false as const, errors: cmdR.error };
  }

  // 3) ã“ã“ã‹ã‚‰å…ˆã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä¿¡ã˜ã¦OKğŸ™‚
  return { ok: true as const, command: cmdR.value };
}
```

---

## 10) ã‚ˆãã‚ã‚‹äº‹æ•…ã¨å¯¾ç­–ğŸ˜±ğŸ§¯

### äº‹æ•…â‘ ï¼šã‚¹ã‚­ãƒ¼ãƒã§å…¨éƒ¨ã‚„ã‚ã†ã¨ã—ã¦ã€å¢ƒç•ŒãŒã‚´ãƒãƒ£ã‚´ãƒãƒ£ğŸŒ€

âœ… å¯¾ç­–ï¼š**ã‚¹ã‚­ãƒ¼ãƒã¯æœ€ä½é™ã«ã—ã¦ã€VOã«å¯„ã›ã‚‹**
ã€Œæ¥­å‹™ãƒ«ãƒ¼ãƒ«ã®ä¸­å¿ƒã¯VOã€ã£ã¦æ±ºã‚ã‚‹ã¨è¿·å­ã«ãªã‚Šã«ãã„ã‚ˆğŸ™‚ğŸ’

### äº‹æ•…â‘¡ï¼šVOã®ã‚¨ãƒ©ãƒ¼ãŒUIã§æ‰±ã„ã¥ã‚‰ã„ğŸ˜µ

âœ… å¯¾ç­–ï¼šã“ã®ç« ã¿ãŸã„ã« **`FieldError { path, message, code }`** ã«çµ±ä¸€ï¼ğŸ«¶âœ¨

### äº‹æ•…â‘¢ï¼šZodã® `superRefine` ã«å…¨éƒ¨è©°ã‚ã¦ã—ã¾ã†ğŸ’¥

`superRefine` ã¯ç›¸é–¢ãƒã‚§ãƒƒã‚¯ã«ä¾¿åˆ©ã ã‘ã©ã€ã‚„ã‚Šã™ãã‚‹ã¨ã€Œãƒ‰ãƒ¡ã‚¤ãƒ³ãŒã‚¹ã‚­ãƒ¼ãƒã«å¯„ã‚‹ã€æ„Ÿã˜ã«ãªã‚‹ã‚ˆã€œâš ï¸
ç›¸é–¢ãƒã‚§ãƒƒã‚¯ä¾‹ã¨ã—ã¦ã¯ã“ã†ã„ã†å½¢ï¼ˆpathæŒ‡å®šã§ãã‚‹ï¼‰ğŸ§· ([Zenn][6])

---

## 11) ã‚‚ã†1æ®µã†ã¾ã„ã‚„ã‚Šæ–¹ï¼ˆãŠå¥½ã¿ã§ğŸ°ï¼‰

### ãƒ‘ã‚¿ãƒ¼ãƒ³Aï¼š**äºŒæ®µéšï¼ˆãŠã™ã™ã‚ï¼‰** âœ…

* ã‚¹ã‚­ãƒ¼ãƒ â†’ DTO
* DTO â†’ VO/ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆã‚¨ãƒ©ãƒ¼çµ±ä¸€ï¼‰

â†’ **å±¤ãŒã‚­ãƒ¬ã‚¤**ã ã—ã€ãƒ†ã‚¹ãƒˆã‚‚ã—ã‚„ã™ã„ğŸ˜

### ãƒ‘ã‚¿ãƒ¼ãƒ³Bï¼šã‚¹ã‚­ãƒ¼ãƒå†…ã§VOåŒ–ï¼ˆtransform/superRefineï¼‰ğŸ§ª

å¢ƒç•Œãƒ•ã‚©ãƒ«ãƒ€å†…ã ã‘ã§å®Œçµã™ã‚‹ãªã‚‰ã‚¢ãƒªï¼
ãŸã ã—ã€ŒVOãŒZodã«å¯„ã£ã¦è¦‹ãˆã‚‹ã€æ§‹é€ ã«ãªã‚Šã‚„ã™ã„ã®ã§ã€**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ–¹é‡ã§çµ±ä¸€**ã—ã¦ã­ğŸ™‚âœ¨

---

## 12) Valibot ã ã¨ã©ã†ãªã‚‹ï¼Ÿï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ã ã‘ğŸ‘€ï¼‰

Valibotã‚‚ã€Œunknownã‚’ã‚¹ã‚­ãƒ¼ãƒã§æ¤œè¨¼ã€ã™ã‚‹ã®ãŒå¾—æ„ãªæ–¹å‘æ€§ã ã‚ˆğŸ«¶ ([valibot.dev][7])
åŸºæœ¬ã¯åŒã˜ã§ã€**æ¤œè¨¼â†’DTOâ†’VO** ã®â€œæ¥ç¶šâ€ã‚’å¢ƒç•Œã§ã‚„ã‚Œã°OKï¼

---

## 13) ãƒŸãƒ‹èª²é¡Œï¼ˆã‚„ã£ã¦ã¿ã‚ˆã€œğŸ§âœ¨ï¼‰

### èª²é¡ŒAï¼ˆåŸºæœ¬ï¼‰âœ…

ã‚ãªãŸã®é¡Œæã§ğŸ‘‡ã‚’1æœ¬ç·šã«ã—ã¦ã­ğŸ§µâœ¨

* `unknownå…¥åŠ› â†’ ã‚¹ã‚­ãƒ¼ãƒ â†’ DTO â†’ VO â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³`

### èª²é¡ŒBï¼ˆã‚¨ãƒ©ãƒ¼çµ±ä¸€ï¼‰ğŸ«¶

ã‚¹ã‚­ãƒ¼ãƒã‚¨ãƒ©ãƒ¼ã‚‚VOã‚¨ãƒ©ãƒ¼ã‚‚ã€åŒã˜ `FieldError[]` ã§è¿”ã›ã‚‹ã‚ˆã†ã«ã™ã‚‹ğŸ™‚

### èª²é¡ŒCï¼ˆç›¸é–¢ãƒ«ãƒ¼ãƒ«ï¼‰ğŸš¦

2ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä»¥ä¸Šã®ãƒ«ãƒ¼ãƒ«ã‚’1å€‹å…¥ã‚Œã‚‹ï¼
ä¾‹ï¼š`startDate <= endDate` / `password !== email` ãªã©âœ¨

---

## 14) AIæ´»ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆã“ã®ç« å‘ã‘ğŸ¤–ğŸ’ï¼‰

* ã€Œã“ã®å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã§æƒ³å®šã™ã¹ãâ€œå¤‰ãªå…¥åŠ›â€ã‚’30å€‹å‡ºã—ã¦ã€ğŸ§ 
* ã€Œã‚¹ã‚­ãƒ¼ãƒã§å¼¾ãã¹ãæœ€ä½æ¡ä»¶ã¨ã€VOã§å®ˆã‚‹ã¹ãä¸å¤‰æ¡ä»¶ã‚’åˆ†ã‘ã¦ææ¡ˆã—ã¦ã€ğŸ§©
* ã€ŒFieldErrorã®messageã‚’å¥³å­å¤§ç”Ÿå‘ã‘ã«å„ªã—ãã—ã¦ã€ğŸ«¶
* ã€Œã“ã®VOã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆæˆåŠŸ/å¤±æ•—/å¢ƒç•Œå€¤ï¼‰ã‚’åˆ—æŒ™ã—ã¦ã€ğŸ§ªâœ¨

---

## ã¾ã¨ã‚ï¼ˆã“ã“ãŒã§ãã‚‹ã¨ä¸€æ°—ã«å¼·ããªã‚‹ğŸ’ªğŸ’ï¼‰

* **ã‚¹ã‚­ãƒ¼ãƒOKã§ã‚‚ãƒ‰ãƒ¡ã‚¤ãƒ³OKã¨ã¯é™ã‚‰ãªã„**ğŸ˜…
* **DTOâ†’VO ã®æ¥ç¶šãŒå±±å ´**ğŸ”ï¸ğŸ”—
* ã‚¨ãƒ©ãƒ¼ã‚’ **åŒã˜å½¢ï¼ˆFieldErrorï¼‰** ã«çµ±ä¸€ã™ã‚‹ã¨ã€UIã‚‚APIã‚‚è¶…ãƒ©ã‚¯ğŸ«¶âœ¨
* ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯ã‚¹ã‚­ãƒ¼ãƒã«ä¾å­˜ã—ãªã„ã‚ˆã†ã«ã€å¢ƒç•Œã«é–‰ã˜è¾¼ã‚ã‚‹ğŸ°ğŸš§

---

æ¬¡ã¯ç¬¬22ç« ã€Œã‚¨ãƒ©ãƒ¼è¨­è¨ˆâ‘ ï¼šåˆ†ã‹ã‚Šã‚„ã™ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã™ã‚‹ğŸ«¶ğŸ§¯ã€ã«è¡Œãã¨ã€**ä»Šä½œã£ãŸ `FieldError` ã‚’â€œã‚‚ã£ã¨è¦ªåˆ‡ã«ã™ã‚‹æŠ€â€**ãŒè‚²ã¤ã‚ˆã€œğŸŒ¸ğŸ˜Š

[1]: https://www.npmjs.com/package/typescript?utm_source=chatgpt.com "TypeScript"
[2]: https://www.npmjs.com/package/zod?utm_source=chatgpt.com "Zod"
[3]: https://zod.dev/v4?utm_source=chatgpt.com "Release notes"
[4]: https://www.npmjs.com/package/valibot?utm_source=chatgpt.com "valibot"
[5]: https://zod.dev/?utm_source=chatgpt.com "Zod: Intro"
[6]: https://zenn.dev/pepabo/articles/b61931ca6820ef?utm_source=chatgpt.com "TypeScriptã®aså‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’Zodã§å‹å®‰å…¨ã«ç½®ãæ›ãˆã‚‹"
[7]: https://valibot.dev/?utm_source=chatgpt.com "Valibot: The modular and type safe schema library"

# ç¬¬13ç« ã€€ç”Ÿæˆã§ä¿è¨¼ï¼šã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿éš ã—ã¦ create/parse ã§å®ˆã‚‹ğŸ­ğŸ”

## ã“ã®ç« ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ğŸ¯âœ¨

* **ã€Œç„¡åŠ¹ãªå€¤ã®ã¾ã¾ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã«å…¥ã‚Œãªã„ã€**ã‚’ä½œã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ğŸ›¡ï¸
* `new` ã‚’ç¦æ­¢ã—ã¦ã€**å¿…ãš `create()` / `parse()` çµŒç”±ã§ã—ã‹ä½œã‚Œãªã„**å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆVOï¼‰ã‚’æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹ğŸ’
* ã€Œã©ã“ã§ `parse` ã—ã¦ã€ã©ã“ã§ `create` ã™ã‚‹ã®ï¼Ÿã€ãŒè¿·ã‚ãªããªã‚‹ğŸ§­âœ¨

---

## ã¾ãšã¯â€œäº‹æ•…ã‚‹è¨­è¨ˆâ€ã‚’1å›ã ã‘è¦‹ã¦ãŠã“ã†ğŸ˜±ğŸ’¥ï¼ˆã‚ã–ã¨ï¼‰

ä¾‹ãˆã° Email ã‚’ãŸã ã® `string` ã«ã—ã¦ã€ã©ã“ã§ã‚‚å…¥ã‚Œã‚‰ã‚Œã‚‹ã¨â€¦

* `"abc"` ã¿ãŸã„ãªãƒ¡ãƒ¼ãƒ«ã˜ã‚ƒãªã„æ–‡å­—ãŒå…¥ã‚‹ğŸ“©âŒ
* `""`ï¼ˆç©ºæ–‡å­—ï¼‰ã‚‚å…¥ã‚‹ğŸ˜µ
* `user.email = "   "` ã¿ãŸã„ã«é€”ä¸­ã§å£Šã‚Œã‚‹ğŸŒ€

ãã—ã¦ã‚³ãƒ¼ãƒ‰ã®ã‚ã¡ã“ã¡ã« `if (...)` ãŒå¢—ãˆã¦ã€**ãƒã‚§ãƒƒã‚¯æ¼ã‚Œ**ãŒèµ·ãã‚‹â€¦ğŸ˜­ğŸ§¨

---

## è§£æ±ºã®ä¸­å¿ƒã‚¢ã‚¤ãƒ‡ã‚¢ğŸ’¡âœ¨

### âœ… ãƒ«ãƒ¼ãƒ«ï¼šVOã¯ã€Œä½œã‚‹ç¬é–“ã€ã«ã—ã‹æ¤œè¨¼ã•ã›ãªã„

ãã®ãŸã‚ã«ã‚„ã‚‹ã“ã¨ã¯ã‚·ãƒ³ãƒ—ãƒ«ğŸ‘‡

1. **ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’éš ã™ï¼ˆprivateï¼‰**ğŸ”’
2. **å¤–ã‹ã‚‰ã¯ `create()` / `parse()` ã§ã—ã‹ä½œã‚Œãªã„**ğŸ­
3. ä½œã‚ŒãŸãªã‚‰ã€Œã‚‚ã†ä¸­ã§ã¯ä¿¡ç”¨ã—ã¦OKã€ğŸ’

---

## create ã¨ parse ã®ä½¿ã„åˆ†ã‘ğŸ§­âœ¨ï¼ˆã“ã“è¶…å¤§äº‹ï¼ï¼‰

è¿·ã£ãŸã‚‰ã“ã®ãƒ«ãƒ¼ãƒ«ã§OKğŸ‘‡

* `parse(raw)`ï¼š**å¤–ã‹ã‚‰æ¥ãŸâ€œç”Ÿã®å…¥åŠ›â€ã‚’å—ã‘ã‚‹**ï¼ˆå¢ƒç•Œå¯„ã‚Šï¼‰ğŸšª

  * ä¾‹ï¼šãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ã€APIã€JSONã€DBã€å¤–éƒ¨API
* `create(value)`ï¼š**ã‚‚ã†æ­£ã—ã„ã¨åˆ†ã‹ã£ã¦ã‚‹ææ–™ã‹ã‚‰ä½œã‚‹**ï¼ˆå†…å´å¯„ã‚Šï¼‰ğŸ°

  * ä¾‹ï¼šè‡ªåˆ†ã®ã‚³ãƒ¼ãƒ‰ã®ä¸­ã§çµ„ã¿ç«‹ã¦æ¸ˆã¿ã€æ­£è¦åŒ–æ¸ˆã¿ã€æ—¢ã«æ¤œè¨¼æ¸ˆã¿

> ã–ã£ãã‚Šè¨€ã†ã¨â€¦
> **parseï¼å¤–ã®ã‚´ãƒŸã‚’æ´—ã†ğŸ§¼ / createï¼ç¶ºéº—ãªææ–™ã§çµ„ã¿ç«‹ã¦ã‚‹ğŸ§±âœ¨**

---

## å®Ÿè£…ä¾‹â‘ ï¼šEmail VOï¼ˆclassï¼‹private constructorï¼‰ğŸ“©ğŸ’

### 1) Resultå‹ï¼ˆå¤±æ•—ã‚’è¿”ã›ã‚‹ç®±ï¼‰ğŸ

ï¼ˆç¬¬9ç« ã®ã‚¿ã‚°ä»˜ããƒ¦ãƒ‹ã‚ªãƒ³ã®å¾©ç¿’ã«ã‚‚ãªã‚‹ã‚ˆğŸ·ï¸âœ¨ï¼‰

```ts
export type Result<T, E> =
  | { ok: true; value: T }
  | { ok: false; error: E };

export const Ok = <T>(value: T): Result<T, never> => ({ ok: true, value });
export const Err = <E>(error: E): Result<never, E> => ({ ok: false, error });
```

### 2) ã‚¨ãƒ©ãƒ¼å‹ï¼ˆâ€œä½•ãŒãƒ€ãƒ¡ã‹â€ã‚’æŒã¦ã‚‹ï¼‰ğŸ§¯

```ts
export type EmailError =
  | { type: "empty" }
  | { type: "invalid_format" };
```

### 3) Emailæœ¬ä½“ï¼ˆnewç¦æ­¢ï¼ï¼‰ğŸ”

```ts
export class Email {
  // å¤–ã‹ã‚‰ç›´æ¥è§¦ã‚Œãªã„ï¼ˆå‹æ‰‹ã«å£Šã•ã‚Œãªã„ï¼‰ğŸ§Š
  private constructor(private readonly value: string) {}

  // å–ã‚Šå‡ºã—å£ã ã‘ç”¨æ„ã™ã‚‹ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰ğŸ‘€
  toString(): string {
    return this.value;
  }

  // å¤–éƒ¨å…¥åŠ›å‘ã‘ï¼šparseï¼ˆrawã‚’å—ã‘ã‚‹ï¼‰ğŸšªğŸ§¼
  static parse(raw: string): Result<Email, EmailError> {
    const trimmed = raw.trim(); // æ­£è¦åŒ–ã®å…¥å£ï¼ˆæœ¬æ ¼çš„ã«ã¯æ¬¡ç« ï¼ï¼‰ğŸ§¼âœ¨

    if (trimmed.length === 0) return Err({ type: "empty" });

    // è¶…ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ¡ãƒ¼ãƒ«åˆ¤å®šï¼ˆæ•™æç”¨ï¼‰ğŸ™‚
    // â€»æœ¬æ ¼é‹ç”¨ã§ã¯è¦ä»¶ã«åˆã‚ã›ã¦å¼·åŒ–ã™ã‚‹ã‚ˆğŸ’ª
    const ok = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(trimmed);
    if (!ok) return Err({ type: "invalid_format" });

    return Ok(new Email(trimmed));
  }

  // å†…éƒ¨å‘ã‘ï¼šcreateï¼ˆææ–™ãŒã‚­ãƒ¬ã‚¤å‰æï¼‰ğŸ°ğŸ§±
  // ä¾‹ï¼šæ—¢ã« parse æ¸ˆã¿ãƒ»æ­£è¦åŒ–æ¸ˆã¿ã®å€¤ã ã‘æ¸¡ã™æƒ³å®š
  static create(normalized: string): Email {
    // â€œå†…éƒ¨ã®ç´„æŸâ€ã¨ã—ã¦ã€ã“ã“ã¯ä¾‹å¤–ã§å®ˆã‚‹ã®ã‚‚ã‚¢ãƒªï¼ˆè¨­è¨ˆæ–¹é‡æ¬¡ç¬¬ï¼‰ğŸ™‚
    // ãŸã ã—æœ¬ç« ã¯ã€Œç”ŸæˆçµŒç”±ã«é›†ç´„ã€ãŒç›®çš„ï¼
    return new Email(normalized);
  }
}
```

### âœ… ã“ã‚Œã§ä½•ãŒå¬‰ã—ã„ã®ï¼ŸğŸ˜

* `new Email("abc")` ãŒ **ã§ããªã„**ï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§æ­¢ã¾ã‚‹ï¼‰âš¡
* Email ã‚’ä½œã‚‹ã«ã¯ **å¿…ãš `parse` ã‚’é€šã‚‹** â†’ å…¥å£ãŒ1ã¤ã«ãªã‚‹ğŸšªâœ¨
* `Email` å‹ã«ãªã£ãŸã‚‰ **â€œãƒ¡ãƒ¼ãƒ«ã¨ã—ã¦æ­£ã—ã„â€ ãŒä¿è¨¼ã•ã‚Œã‚‹**ğŸ’

---

## ä½¿ã„æ–¹ï¼ˆå¢ƒç•Œâ†’parseã€å†…å´â†’Emailã¨ã—ã¦æ‰±ã†ï¼‰ğŸšªâ¡ï¸ğŸ°

ä¾‹ãˆã°ã€Œä¼šå“¡ç™»éŒ²ã€ã®å…¥å£ã§ğŸ‘‡

```ts
type RegisterRequest = {
  email: unknown; // å¤–ã‹ã‚‰æ¥ãŸã‚‚ã®ã¯ä¿¡ç”¨ã—ãªã„ï¼ğŸ•µï¸â€â™€ï¸
};

function register(req: RegisterRequest) {
  if (typeof req.email !== "string") {
    return { status: 400, message: "email ã¯æ–‡å­—åˆ—ã§é€ã£ã¦ã­ğŸ™" };
  }

  const emailResult = Email.parse(req.email);
  if (!emailResult.ok) {
    return { status: 400, message: toMessage(emailResult.error) };
  }

  const email = emailResult.value; // ã“ã“ã‹ã‚‰ã¯ Email ã¨ã—ã¦ä¿¡ç”¨ã—ã¦OKğŸ’
  // domain.register(email) ã¿ãŸã„ã«æ¸¡ã›ã‚‹âœ¨
  return { status: 200 };
}

function toMessage(err: EmailError): string {
  switch (err.type) {
    case "empty":
      return "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç©ºã ã‚ˆğŸ¥º";
    case "invalid_format":
      return "ãƒ¡ãƒ¼ãƒ«ã®å½¢ã˜ã‚ƒãªã„ã¿ãŸã„ğŸ’¦ ä¾‹: neko@example.com";
  }
}
```

---

## å®Ÿè£…ä¾‹â‘¡ï¼šclassã‚’ä½¿ã‚ãªã„ç‰ˆï¼ˆfactoryé–¢æ•°ï¼‹Brandï¼‰ğŸ·ï¸âœ¨

ã€ŒVOã¯é–¢æ•°ã§ä½œã‚‹æ´¾ã€ã‚‚ã„ã‚‹ã®ã§ã€é¸ã¹ã‚‹ã‚ˆã†ã«ç½®ã„ã¨ãã­ğŸ™‚

```ts
type Brand<T, B extends string> = T & { readonly __brand: B };
export type Email = Brand<string, "Email">;

export type EmailError =
  | { type: "empty" }
  | { type: "invalid_format" };

export function parseEmail(raw: string): Result<Email, EmailError> {
  const trimmed = raw.trim();
  if (trimmed.length === 0) return Err({ type: "empty" });

  const ok = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(trimmed);
  if (!ok) return Err({ type: "invalid_format" });

  return Ok(trimmed as Email); // â€œã“ã“ã ã‘â€ã§å‹ã‚’ä»˜ã‘ã‚‹ã®ãŒãƒã‚¤ãƒ³ãƒˆğŸ”’
}
```

âœ… classç‰ˆã®å¼·ã¿ï¼š**å†…éƒ¨çŠ¶æ…‹ã‚’éš ã›ã‚‹ï¼ˆã‚«ãƒ—ã‚»ãƒ«åŒ–ï¼‰**ğŸ§Š
âœ… Brandç‰ˆã®å¼·ã¿ï¼š**è»½ã„ãƒ»ã‚·ãƒ³ãƒ—ãƒ«ãƒ»å€¤ãŒãã®ã¾ã¾string**âš¡

---

## ã‚ˆãã‚ã‚‹è½ã¨ã—ç©´ï¼ˆã“ã“è¸ã‚€ã¨å´©ã‚Œã‚‹ï¼‰âš ï¸ğŸ˜µâ€ğŸ’«

* `as Email` ã‚’ã‚ã¡ã“ã¡ã§ä½¿ã„å§‹ã‚ã‚‹ï¼ˆå…¥å£ãŒå¢—æ®–ï¼‰ğŸ§Ÿâ€â™€ï¸
  â†’ **ã€Œas ã¯å¢ƒç•Œã®â€œãŸã£ãŸ1ç®‡æ‰€â€ã ã‘ã€**ã«ç¸›ã‚ã†ğŸ”’
* `public constructor` ã«ã—ã¡ã‚ƒã†ï¼ˆnew ã§ãã¦çµ‚ã‚ã‚‹ï¼‰ğŸ’¥
* VOã®ä¸­èº«ã‚’ `public value: string` ã«ã™ã‚‹ï¼ˆå¤–ã‹ã‚‰æ›¸ãæ›ãˆã‚‰ã‚Œã¦å£Šã‚Œã‚‹ï¼‰ğŸŒ€
  â†’ `private readonly` ï¼‹ `toString()` ãªã©èª­ã¿å–ã‚Šã ã‘ã«ã—ã‚ˆğŸ™‚

---

## ãƒŸãƒ‹èª²é¡ŒğŸ’âœ¨ï¼ˆæ‰‹ã‚’å‹•ã‹ã™ã¨ä¸€æ°—ã«è…‘ã«è½ã¡ã‚‹ã‚ˆï¼‰

ã‚ãªãŸã®é¡Œæã§ VO ã‚’1å€‹ã ã‘ä½œã£ã¦ã¿ã¦ã­ğŸ‘‡

1. å€™è£œã‚’1ã¤é¸ã¶ï¼ˆä¾‹ï¼š`UserId` / `Tag` / `Price` / `Quantity`ï¼‰ğŸ¯
2. `new` ã‚’ç¦æ­¢ï¼ˆprivate constructor or factory onlyï¼‰ğŸ”’
3. `parse()` ã‚’ä½œã‚‹ï¼ˆrawå…¥åŠ›â†’Resultï¼‰ğŸšª
4. å…¥å£ã®1ç®‡æ‰€ã§ `parse` ã—ã¦ã€ä»¥é™ã¯ VO å‹ã§å›ã™ğŸ’

---

## AIæ´»ç”¨ã‚³ãƒ¼ãƒŠãƒ¼ğŸ¤–âœ¨ï¼ˆã“ã®ç« ã¨ç›¸æ€§ã„ã„ï¼ï¼‰

Copilot / Codex ãªã©ã«ã¯ã“ã†èãã¨å¼·ã„ã‚ˆğŸ‘‡

* ã€ŒEmailã¨ã—ã¦å¼¾ãã¹ãå…¥åŠ›ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’20å€‹å‡ºã—ã¦ğŸ§ ã€
* ã€Œã“ã® `parse()` ã®æ­£è¦è¡¨ç¾ã€å¼±ã„ã¨ã“ã‚ã‚’æŒ‡æ‘˜ã—ã¦ğŸ‘€ã€
* ã€Œ`EmailError` ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘æ–‡è¨€ã«ã™ã‚‹ switch ã‚’ä½œã£ã¦ğŸ«¶ã€
* ã€Œâ€œas ã‚’ä¹±ç”¨ã—ã¦ã—ã¾ã†å±é™ºãƒ«ãƒ¼ãƒˆâ€ ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ğŸ”ã€

â€»ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã¯ã€**â€œå…¥å£ãŒ1ã¤ã«ãªã£ã¦ã‚‹ã‹ï¼Ÿâ€**ã ã‘å¿…ãšãƒã‚§ãƒƒã‚¯ã­âœ…âœ¨

---

## æœ€æ–°å‹•å‘ãƒ¡ãƒ¢ï¼ˆæœ¬æ—¥æ™‚ç‚¹ï¼‰ğŸ“°âœ¨

* TypeScript ã¯ **5.9 ç³»ï¼ˆ5.9.3 ãŒ Latest è¡¨è¨˜ï¼‰**ãŒç¢ºèªã§ãã‚‹ã‚ˆã€‚([GitHub][1])
* ãã—ã¦ Microsoft ã¯ **TypeScript 6.0ï¼ˆæ©‹æ¸¡ã—ï¼‰â†’ 7.0ï¼ˆãƒã‚¤ãƒ†ã‚£ãƒ–ç‰ˆï¼‰**ã®æµã‚Œã‚’é€²ã‚ã¦ã„ã‚‹ã‚ˆï¼ˆæ—©æœŸ 2026 ç›®æ¨™ï¼‰ã€‚([Microsoft for Developers][2])
* VS Code ã¯ **2026/01/08 ã« 1.108ï¼ˆDecember 2025 ãƒªãƒªãƒ¼ã‚¹ï¼‰**ãŒå‡ºã¦ã‚‹ã‚ˆã€‚([Visual Studio Code][3])

---

## ã¾ã¨ã‚ğŸ€

* **ã€Œç„¡åŠ¹ãªçŠ¶æ…‹ã‚’ä½œã‚Œãªã„ã€**ã®ä¸­å¿ƒãƒ†ã‚¯ã¯ã€**ä½œã‚Šæ–¹ã‚’1æœ¬åŒ–ã™ã‚‹ã“ã¨**ğŸ­ğŸ”
* `new` ã‚’å°å°ã—ã¦ã€**`parse/create` ã®ã©ã¡ã‚‰ã‹ã‚’å¿…ãšé€šã™**ğŸšªâœ¨
* `parseï¼å¤–ã‹ã‚‰æ¥ãŸã‚‚ã®ç”¨`ã€`createï¼å†…å´ã®ææ–™ç”¨` ğŸ§¼ğŸ§±
* ã“ã‚ŒãŒã§ãã‚‹ã¨ã€æ¬¡ç« ï¼ˆæ­£è¦åŒ–ğŸ§¼âœ¨ï¼‰ãŒã‚ã¡ã‚ƒæ°—æŒã¡ã‚ˆããªã‚‹ã‚ˆã€œï¼ğŸ‰ğŸ’

[1]: https://github.com/microsoft/typescript/releases "Releases Â· microsoft/TypeScript Â· GitHub"
[2]: https://devblogs.microsoft.com/typescript/progress-on-typescript-7-december-2025/?utm_source=chatgpt.com "Progress on TypeScript 7 - December 2025"
[3]: https://code.visualstudio.com/updates "December 2025 (version 1.108)"
